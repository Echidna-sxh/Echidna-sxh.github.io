<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="Echidna的小窝" href="https://echidna-sxh.github.io/rss.xml"><link rel="alternate" type="application/atom+xml" title="Echidna的小窝" href="https://echidna-sxh.github.io/atom.xml"><link rel="alternate" type="application/json" title="Echidna的小窝" href="https://echidna-sxh.github.io/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><link rel="canonical" href="https://echidna-sxh.github.io/grasscutter/grasscutter/"><title>grasscutter———— 原神私服搭建过程 - genshin | Echidna = Echidna 的小窝 = l am the bone of my sword</title><meta name="generator" content="Hexo 5.4.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">grasscutter———— 原神私服搭建过程</h1><div class="meta"><span class="item" title="创建时间：2022-08-16 16:29:28"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2022-08-16T16:29:28+08:00">2022-08-16</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>8.3k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>8 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Echidna</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://echidna-sxh.oss-cn-beijing.aliyuncs.com/echidna-sxh/54750642_p0.jpg"></li><li class="item" data-background-image="https://echidna-sxh.oss-cn-beijing.aliyuncs.com/echidna-sxh/54611904_p0.jpg"></li><li class="item" data-background-image="https://echidna-sxh.oss-cn-beijing.aliyuncs.com/echidna-sxh/20.jpg"></li><li class="item" data-background-image="https://echidna-sxh.oss-cn-beijing.aliyuncs.com/echidna-sxh/28.jpg"></li><li class="item" data-background-image="https://echidna-sxh.oss-cn-beijing.aliyuncs.com/echidna-sxh/62564332_p0.png"></li><li class="item" data-background-image="https://echidna-sxh.oss-cn-beijing.aliyuncs.com/echidna-sxh/27.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/genshin/" itemprop="item" rel="index" title="分类于 genshin"><span itemprop="name">genshin</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://echidna-sxh.github.io/grasscutter/grasscutter/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="Echidna"><meta itemprop="description" content="l am the bone of my sword, "></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Echidna 的小窝"></span><div class="body md" itemprop="articleBody"><h1 id="grasscutter-使用指南androidwindowsios端均已支持"><a class="anchor" href="#grasscutter-使用指南androidwindowsios端均已支持">#</a> grasscutter 使用指南 ——Android/Windows/IOS 端均已支持</h1><h2 id="前言"><a class="anchor" href="#前言">#</a> 前言</h2><p>grasscutter 是某二次元手游的开源后端，目前功能并不完整，但正在 contributers 正在全速开发中，未来可期。可以部署在 linux 和 windows 下，通过代理与各种平台的客户端进行交互。本文提供 grasscutter 的 linux 端部署（windows 端比较简单）、windows/andriod/ios 端的客户端连接指导，其中安卓提供机器 root 和非 root 两种情况下的解决方案。本文需要有一定的计算机基础，不面向小白，尽量说的详细，说明部分可能包含简单的 shell 命令，自行执行，不提供一键安装脚本，不提供已搭建完成的服务器，适合爱折腾的玩家，不希望任何人以此盈利，欢迎进行技术交流，有问题可以问。</p><p>关键突破点为 mitmproxy 在安卓客户端的 ca 证书安装，安卓可以使用 vmos 获得一个 root 过的虚拟机（vmos 不要在应用商店下载，有关键功能阉割，去官网下载。root 功能需要 vip，有慈禧预付费版本，不想花钱的可以自己动手找一下）</p><h2 id="更新"><a class="anchor" href="#更新">#</a> 更新</h2><p>目前 dev 版本已更新秘境和深渊，大世界支持联机。</p><h2 id="关键词"><a class="anchor" href="#关键词">#</a> 关键词</h2><p>SSL、CA 证书、grasscutter、某二次元游戏、代理转发、http 注入、安卓、IOS、windows</p><h2 id="环境准备"><a class="anchor" href="#环境准备">#</a> 环境准备</h2><ol><li>java se 17</li><li>mongodb 4.0+</li><li>mitmproxy</li></ol><p>环境准备请自行度娘解决</p><h2 id="linux服务端搭建centos7"><a class="anchor" href="#linux服务端搭建centos7">#</a> linux 服务端搭建（centos7）</h2><p>1.git 拉取 或 直接<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0dyYXNzY3V0dGVycy9HcmFzc2N1dHRlcg==">下载</span>源代码，并上传到服务器，tar -xzf 解压缩</p><pre><code>git clone -b development https://github.com/Grasscutters/Grasscutter.git
</code></pre><p>注意下载的 dev 版本（如果编译不通过，又不想调试，可以改下 stable 版本）</p><h3 id="1关闭防火墙或配置放行策略注意除了常规端口外要放行tcp和udp的22102端口"><a class="anchor" href="#1关闭防火墙或配置放行策略注意除了常规端口外要放行tcp和udp的22102端口">#</a> 1. 关闭防火墙或配置放行策略（注意除了常规端口外，要放行 TCP 和 UDP 的 22102 端口）</h3><pre><code>systemctl stop firewalld
</code></pre><p>我就比较直接，23333。如果是云服务器，记得去控制台配置一下安全组策略，服务端 90% 的问题来自这里。</p><h3 id="2-启动mongodb自行百度linux下如何启动mongodb这个基本上没啥问题后续出现27017端口问题或mongodb类似的报错多半是mongo服务没起或者挂了"><a class="anchor" href="#2-启动mongodb自行百度linux下如何启动mongodb这个基本上没啥问题后续出现27017端口问题或mongodb类似的报错多半是mongo服务没起或者挂了">#</a> 2. 启动 mongodb，自行百度 linux 下如何启动 mongodb，这个基本上没啥问题，后续出现 27017 端口问题或 mongodb 类似的报错，多半是 mongo 服务没起或者挂了。</h3><ul><li>这里提供一个<span class="exturl" data-url="aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC8xMTA4NjkxNTU=">教程</span>，执行到启动 mongodb 服务并验证即可。</li></ul><h3 id="3-编译需要java17环境自带gradle全自动编译脚本执行就完事了"><a class="anchor" href="#3-编译需要java17环境自带gradle全自动编译脚本执行就完事了">#</a> 3. 编译，需要 java17 环境自带 gradle 全自动编译脚本，执行就完事了。</h3><pre><code>sh gradlew jar
</code></pre><p>执行时间视服务器配置而定，如有报错，请检查你的 java 环境和网络环境，善用度娘</p><p>编译成功后会在 grasscutter 的主目录下 生成一个 grasscutter 开头（加版本号）的 jar 文件，直接运行</p><pre><code>java -jar grasscutter-1.1.0.jar #1.1.0是我下载的版本
</code></pre><p>会提示缺少资源文件，并给你创好了资源文件的目录（resources，没创的话自行创一下），里面的内容需要你自己下载。</p><h3 id="4-下载资源文件"><a class="anchor" href="#4-下载资源文件">#</a> 4. 下载资源文件</h3><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL21lbWV0cm9sbHNYRC9HcmFzc2N1dHRlcl9SZXNvdXJjZXM=">github 地址</span></p><p>注：此仓库被 github 停掉的概率较高，注意备份，原因不多说了，dddd。</p><pre><code>git clone https://github.com/memetrollsXD/Grasscutter_Resources.git
</code></pre><p>将 Resources 下的文件全部复制到 grasscutter 根目录下的 resources 文件夹中，包括 BinOutput、ExcelBinOutput、Readable、Scripts、Subtitle、TextMap</p><h3 id="5-启动服务器"><a class="anchor" href="#5-启动服务器">#</a> 5. 启动服务器</h3><p>修改配置文件 config.json</p><pre><code>&#123;
  &quot;DatabaseUrl&quot;: &quot;mongodb://localhost:27017&quot;,
  &quot;DatabaseCollection&quot;: &quot;grasscutter&quot;,
  &quot;RESOURCE_FOLDER&quot;: &quot;./resources/&quot;,
  &quot;DATA_FOLDER&quot;: &quot;./data/&quot;,
  &quot;PACKETS_FOLDER&quot;: &quot;./packets/&quot;,
  &quot;DUMPS_FOLDER&quot;: &quot;./dumps/&quot;,
  &quot;KEY_FOLDER&quot;: &quot;./keys/&quot;,
  &quot;SCRIPTS_FOLDER&quot;: &quot;./resources/Scripts/&quot;,
  &quot;PLUGINS_FOLDER&quot;: &quot;./plugins/&quot;,
  &quot;DebugMode&quot;: &quot;NONE&quot;,
  &quot;RunMode&quot;: &quot;HYBRID&quot;,
  &quot;GameServer&quot;: &#123;
    &quot;Name&quot;: &quot;Test&quot;,
    &quot;Ip&quot;: &quot;0.0.0.0&quot;,
    &quot;PublicIp&quot;: &quot;your public ip&quot;,
    &quot;Port&quot;: 22102,
    &quot;PublicPort&quot;: 0,
    &quot;DispatchServerDatabaseUrl&quot;: &quot;mongodb://localhost:27017&quot;,
    &quot;DispatchServerDatabaseCollection&quot;: &quot;grasscutter&quot;,
    &quot;InventoryLimitWeapon&quot;: 2000,
    &quot;InventoryLimitRelic&quot;: 2000,
    &quot;InventoryLimitMaterial&quot;: 2000,
    &quot;InventoryLimitFurniture&quot;: 2000,
    &quot;InventoryLimitAll&quot;: 30000,
    &quot;MaxAvatarsInTeam&quot;: 4,
    &quot;MaxAvatarsInTeamMultiplayer&quot;: 4,
    &quot;MaxEntityLimit&quot;: 1000,
    &quot;WatchGacha&quot;: false,
    &quot;ServerNickname&quot;: &quot;Server&quot;,
    &quot;ServerAvatarId&quot;: 10000007,
    &quot;ServerNameCardId&quot;: 210001,
    &quot;ServerLevel&quot;: 1,
    &quot;ServerWorldLevel&quot;: 1,
    &quot;ServerSignature&quot;: &quot;Server Signature&quot;,
    &quot;WelcomeEmotes&quot;: [
      2007,
      1002,
      4010
    ],
    &quot;WelcomeMotd&quot;: &quot;Welcome to Grasscutter emu&quot;,
    &quot;WelcomeMailTitle&quot;: &quot;Welcome to Grasscutter!&quot;,
    &quot;WelcomeMailSender&quot;: &quot;Lawnmower&quot;,
    &quot;WelcomeMailContent&quot;: &quot;Hi there!\r\nFirst of all, welcome to Grasscutter. If you have any issues, please let us know so that Lawnmower can help you! \r\n\r\nCheck out our:\r\n\u003ctype\u003d\&quot;browser\&quot; text\u003d\&quot;Discord\&quot; href\u003d\&quot;https://discord.gg/T5vZU6UyeG\&quot;/\u003e&quot;,
    &quot;WelcomeMailItems&quot;: [
      &#123;
        &quot;itemId&quot;: 13509,
        &quot;itemCount&quot;: 1,
        &quot;itemLevel&quot;: 1
      &#125;,
      &#123;
        &quot;itemId&quot;: 201,
        &quot;itemCount&quot;: 10000,
        &quot;itemLevel&quot;: 1
      &#125;
    ],
    &quot;EnableOfficialShop&quot;: true,
    &quot;Game&quot;: &#123;
      &quot;ADVENTURE_EXP_RATE&quot;: 1.0,
      &quot;MORA_RATE&quot;: 1.0,
      &quot;DOMAIN_DROP_RATE&quot;: 1.0
    &#125;
  &#125;,
  &quot;DispatchServer&quot;: &#123;
    &quot;Ip&quot;: &quot;0.0.0.0&quot;,
    &quot;PublicIp&quot;: &quot;your public ip&quot;,
    &quot;Port&quot;: 14514,
    &quot;PublicPort&quot;: 0,
    &quot;KeystorePath&quot;: &quot;./keystore.p12&quot;,
    &quot;KeystorePassword&quot;: &quot;123456&quot;,
    &quot;UseSSL&quot;: true,
    &quot;FrontHTTPS&quot;: true,
    &quot;CORS&quot;: false,
    &quot;CORSAllowedOrigins&quot;: [
      &quot;*&quot;
    ],
    &quot;AutomaticallyCreateAccounts&quot;: false,
    &quot;defaultPermissions&quot;: [
      &quot;&quot;
    ],
    &quot;GameServers&quot;: []
  &#125;,
  &quot;LocaleLanguage&quot;: &quot;en_US&quot;,
  &quot;DefaultLanguage&quot;: &quot;en&quot;,
  &quot;OpenStamina&quot;: true
&#125;
</code></pre><p>其实只需要修改两处 publicip 为你的公网 ip，以及如果你不想用 443 端口，修改一下 DispatchServer.port 即可，注意这里修改的话，下面的 mitmdump 的配置也需要同步修改。其他的不涉及网络的选项，你自己看着改。</p><p>（我开的端口有点臭，23333）</p><p>再执行一次启动命令</p><pre><code>java -jar grasscutter-1.1.0.jar
</code></pre><p>显示游戏服务器在 22102 端口运行，转发服务器在 14514 端口运行，即为成功。</p><p>此时参照命令表，在该 shell 窗口输入账号创建命令</p><pre><code>account create echidna 114514233
</code></pre><p>会提示账号创建成功。</p><h3 id="qa"><a class="anchor" href="#qa">#</a> QA</h3><ol><li>java 编译失败</li></ol><p>列出我遇到的几种可能原因，</p><ul><li><ol><li>java 环境没配好，这属于最不太可能的错误，但还是检测一下，输入 java --version，看是不是 17 点几版本的，不是赶紧换。</li></ol></li><li><ol start="2"><li>网络问题，编译过程会给你安装 gradle 和一系列 jar 依赖，看看卡在哪里了自行下载后导入。</li></ol></li><li><ol start="3"><li>内存问题，编译需要占用较多内存，实测内存 512MB 失败，2G 成功，运行时最低需要 1G 内存，（本来想用 vps 服务器的，但 vps 配置较差，没编过去，哈哈哈）</li></ol></li><li><ol start="4"><li>程序问题，dev 版本编译建失败实属正常现象，要么自己调一下，要么换 stable 版本。</li></ol></li><li><ol start="5"><li>上述是我实际遇到过的问题，如依然不能解决，自行百度，本人 C++ 工程师，java 属实有点专业盲区。</li></ol></li></ul><ol start="2"><li>程序运行失败</li></ol><ul><li><ol><li>确认你的 resources 目录正常存在于编译生成的入口 jar 文件的同级目录下，并内容齐全。</li></ol></li><li><ol start="2"><li>确认你 config.json 文件的 json 格式没有被破坏，比如手滑多删了个引号（还真有人这么蠢，是谁呢，不会是我吧？）</li></ol></li><li><ol start="3"><li>确认你的 mongodb 的守护进程正常，ps -aux | grep mongod</li></ol></li><li><ol start="4"><li>确认没有程序占用你的端口，netstat -tunlp | grep &lt;你设置的端口，默认是 443&gt;，linux 下的常见犯人叫 ngnix，windows 下的常见犯人叫 vmware，重点检查。</li></ol></li><li><ol start="5"><li>确认你的可用内存大于 1G</li></ol></li><li><ol start="6"><li>提示密码错误的，可以把 config.json 中的 DispatchServer.KeystorePassword 改为空（原本是空的改为 123456，每个版本的 key 可能放的不一样，反正两个总有一个是对的）。</li></ol></li></ul><h3 id="6-配置抓包以及http注入"><a class="anchor" href="#6-配置抓包以及http注入">#</a> 6. 配置抓包以及 http 注入</h3><ul><li><p>这里我们用到 mitmproxy，我看到不少人使用 fiddler，但 fiddler 是基于.net 开发的程序，移植到 linux 并不方便。</p></li><li><p>可以直接使用 pip3 安装，没装 python3 的 yum 装一下。</p></li></ul><pre><code>pip3 install mitmproxy
</code></pre><ul><li><p>会给你安装 mitmproxy 及其命令行版本，即 mitmdump，还有其多版本的 ca 证书</p></li><li><p>也可以去官网下载二进制版本，但不带 ca 证书，需要你自行部署完成后开启代理并访问 mitm.it 下载，但国内的云服务器不允许域名转发到未备案域名，所以会比较麻烦。</p></li><li><p>安装完成后，我们回到 grasscutter 的主目录</p><pre><code>  vim proxy_config.py
</code></pre><p>修改配置文件，如下：</p><pre><code>  import os

  # This can also be replaced with another IP address.
  USE_SSL = True
  REMOTE_HOST = &quot;your public ip&quot;
  REMOTE_PORT = 14514

  if os.getenv('MITM_REMOTE_HOST') != None:
      REMOTE_HOST = os.getenv('MITM_REMOTE_HOST')
  if os.getenv('MITM_REMOTE_PORT') != None:
      REMOTE_PORT = int(os.getenv('MITM_REMOTE_PORT'))
  if os.getenv('MITM_USE_SSL') != None:
      USE_SSL = bool(os.getenv('MITM_USE_SSL'))

  print('MITM Remote Host: ' + REMOTE_HOST)
  print('MITM Remote Port: ' + str(REMOTE_PORT))
  print('MITM Use SSL ' + str(USE_SSL))
</code></pre><p>注意此处的 REMOTE_PORT 要与上面你修改的 dispatchsever 的 port 一致。</p><ul><li>配置 ca 证书</li></ul><pre><code>cp ~/.mitmproxy/mitmproxy-ca-cert.crt /etc/ssl/certs # 这句是安装为根证书，未必需要
cp ~/.mitmproxy/mitmproxy-ca-cert.pem /etc/pki/ca-trust/source/anchors
update-ca-trust extract
</code></pre><ul><li><p>执行转发。重点来了，mitmproxy 的安卓代理存在诸多问题，需要添加一系列参数进行规避，而这部分，大部分教程并未提及</p><pre><code>mitmdump -s proxy.py --ssl-insecure --set block_global=false --no-http2
</code></pre><p>允许不安全的 ssl 连接，禁用 http2 连接，以及禁用 internet 对 mitmproxy 的直接访问，。</p></li></ul></li></ul><p>此时，代理服务器会在默认的 8080 端口启动，同样请确保端口不会冲突。</p><h2 id="windows端登陆"><a class="anchor" href="#windows端登陆">#</a> windows 端登陆</h2><ul><li><p>配置 ca 证书</p><p>将服务器端～/.mitmproxy 文件夹下的 mitmproxy-ca-cert.p12 文件拿到 windows 机器上，直接双击，选择给本地计算机安装，要密码直接空过，自动选择目录即可，重启机器。</p></li><li><p>windows 端支持国服和国际服客户端登录，方法非常简单，打开网络和 Internet 设置，选择代理，打开手动设置代理选项，填写地址和端口，即为你上面设置的 publicip 和 mitmdump 的端口（默认 8080 那个）。</p></li><li><p>打开客户端，直接用你创建的账号密码登录即可。</p></li></ul><h2 id="qa-2"><a class="anchor" href="#qa-2">#</a> QA</h2><ul><li><p>为啥我客户端提示网络异常？</p><p>代理端口不对，建议检查你的 mitmproxy 是否活着，端口号是否正确。</p></li><li><p>为啥 4206 了？</p><p>大抵是证书装的有问题罢，要么你没有全局安装，要么可以把上面那个 mitmproxy 目录下的另外一个 p12 文件也拉出装一下，目前未验证 grasscutter 下的证书是否需要安装，可以尝试一下安装那个 grasscutter 下的 keystore.p12 文件。</p></li><li><p>连上去后网络非常不稳定</p><p>你服务器带宽问题。</p></li><li><p>登录进去显示 12-4301</p><p>建议切换美服通道登录</p></li><li><p>为啥我发现我 nohup 后台运行程序的服务器炸了？</p><p>硬盘炸了，ssh 连不上的话，先去控制台重启一下。首先，必须重定向 nohup 到 dev/null，而且目前 grasscutter 有 bug，会往主目录的 log 文件夹里疯狂写入 latest.log，目前 config.json 中未发现相关选择，本人是懒得去代码里找，直接选择删除 latest.log。</p></li><li><p>其他问题</p><p>检查你的有没有科学上网啥的，关了。</p></li></ul><h2 id="ios端登录"><a class="anchor" href="#ios端登录">#</a> IOS 端登录</h2><ul><li>自行搜索 ios 如何安装 ca 证书，我们要安装的 ca 证书是～/.mitmproxy 目录下的 mitmproxy-ca-cert.pem，注意下载完成后要去找到这个文件，点一下，然后再执行证书安装的两个步骤（先安装再信任）。</li><li>不要使用小火箭，会有 bug，原因很简单，小火箭不会转发 udp 报文，但我们的 grasscuter 是依赖于 kcp 这种 udp 协议的。</li><li>IOS 端一把成功，没遇到啥问题，有问题应该和上述 windows 端差不多的解决方法。</li></ul><h2 id="android端登录"><a class="anchor" href="#android端登录">#</a> Android 端登录</h2><p>比上面的都要复杂，问题主要出在，Android7.0 往后，应用可以选择不信任用户证书，而很遗憾该手游 app 就是设置为不信任的那种，基于此，我想出 3 条解决方案。</p><ul><li>magisk，就是俗称的面具 root，不过没有备用机，不打算刷掉我的正常使用的手机，并不考虑。</li><li>改包，设置为接受用户证书，然后重新打包，值得一试。</li><li>使用虚拟机，也就是安卓模拟器。</li></ul><p>乍一看，第三点是一个非常抽象的想法，这意味着要在安卓机上装安卓模拟器，这不搞笑吗。但找了一下，真的有这种东西，vmos pro。</p><p>至于这玩意咋整，应该没啥技术难度，注意我之前说的关于 vmos pro 的注意事项即可，剩下的百度解决。</p><p>当我们有了一个 root 过的虚拟机的时候，我需要将 ca 证书安装到系统目录下，为此需要 openssl 进行安卓系统 ca 证书的制作。</p><pre><code>
yum install openssl
openssl x509 -inform PEM -subject_hash_old -in mitmproxy-ca-cert.pem -noout
cp mitmproxy-ca-cert.pem c8750f0d.0 # 这边的c8750f0d是上一条命令的输出。
</code></pre><p>将这个文件放入 /system/etc/security/cacerts/ 下，并修改权限为 644</p><p>设置中长按你所连接的 wifi，选择修改网络，设置代理，和上面的其他客户端一样的要求。</p><p>连接即可，注意需要国际服客户端。</p><h2 id="结语"><a class="anchor" href="#结语">#</a> 结语</h2><p>本人网络方向 C++ 工程师，本来以为可以一晚上解决的，但其实还是研究了不少时间的，毕竟要跑 dev 版本的 java 的代码（我跑的那个版本编译都有问题 2333），以及一堆 ca 证书问题，终于全客户端搞定了这玩意，搭建了一个服务器和朋友一起玩玩。为防止一切侵权隐患，以及屏蔽正义游侠，文章概不放图，但该讲到的节点都讲到了，有需要技术支持的请评论区留言，技术支持不收费，三言两语能解决的我都会回答（只要你不是小白，大部分问题属于这种），想以此盈利的请勿打扰（之前看到一个群友截图，大致说是有个卖家某宝 98 出售私服，结果买家进群，卖家说 windows 和 ios 都解决了，让大家等等安卓端的解决方案，笑死）。</p></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2022-10-12 19:50:03" itemprop="dateModified" datetime="2022-10-12T19:50:03+08:00">2022-10-12</time> </span><span id="grasscutter/grasscutter/" class="item leancloud_visitors" data-flag-title="grasscutter———— 原神私服搭建过程" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span class="leancloud-visitors-count"></span> <span class="text">次</span></span></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>Echidna <i class="ic i-at"><em>@</em></i>Echidna 的小窝</li><li class="link"><strong>本文链接：</strong> <a href="https://echidna-sxh.github.io/grasscutter/grasscutter/" title="grasscutter———— 原神私服搭建过程">https://echidna-sxh.github.io/grasscutter/grasscutter/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/songs/secret%20base/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;echidna-sxh.oss-cn-beijing.aliyuncs.com&#x2F;echidna-sxh&#x2F;60562461_p0.jpg" title="secret base"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> songs</span><h3>secret base</h3></a></div><div class="item right"></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#grasscutter-%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97androidwindowsios%E7%AB%AF%E5%9D%87%E5%B7%B2%E6%94%AF%E6%8C%81"><span class="toc-number">1.</span> <span class="toc-text">grasscutter 使用指南 ——Android&#x2F;Windows&#x2F;IOS 端均已支持</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0"><span class="toc-number">1.2.</span> <span class="toc-text">更新</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E8%AF%8D"><span class="toc-number">1.3.</span> <span class="toc-text">关键词</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-number">1.4.</span> <span class="toc-text">环境准备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#linux%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%90%AD%E5%BB%BAcentos7"><span class="toc-number">1.5.</span> <span class="toc-text">linux 服务端搭建（centos7）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E5%85%B3%E9%97%AD%E9%98%B2%E7%81%AB%E5%A2%99%E6%88%96%E9%85%8D%E7%BD%AE%E6%94%BE%E8%A1%8C%E7%AD%96%E7%95%A5%E6%B3%A8%E6%84%8F%E9%99%A4%E4%BA%86%E5%B8%B8%E8%A7%84%E7%AB%AF%E5%8F%A3%E5%A4%96%E8%A6%81%E6%94%BE%E8%A1%8Ctcp%E5%92%8Cudp%E7%9A%8422102%E7%AB%AF%E5%8F%A3"><span class="toc-number">1.5.1.</span> <span class="toc-text">1. 关闭防火墙或配置放行策略（注意除了常规端口外，要放行 TCP 和 UDP 的 22102 端口）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%90%AF%E5%8A%A8mongodb%E8%87%AA%E8%A1%8C%E7%99%BE%E5%BA%A6linux%E4%B8%8B%E5%A6%82%E4%BD%95%E5%90%AF%E5%8A%A8mongodb%E8%BF%99%E4%B8%AA%E5%9F%BA%E6%9C%AC%E4%B8%8A%E6%B2%A1%E5%95%A5%E9%97%AE%E9%A2%98%E5%90%8E%E7%BB%AD%E5%87%BA%E7%8E%B027017%E7%AB%AF%E5%8F%A3%E9%97%AE%E9%A2%98%E6%88%96mongodb%E7%B1%BB%E4%BC%BC%E7%9A%84%E6%8A%A5%E9%94%99%E5%A4%9A%E5%8D%8A%E6%98%AFmongo%E6%9C%8D%E5%8A%A1%E6%B2%A1%E8%B5%B7%E6%88%96%E8%80%85%E6%8C%82%E4%BA%86"><span class="toc-number">1.5.2.</span> <span class="toc-text">2. 启动 mongodb，自行百度 linux 下如何启动 mongodb，这个基本上没啥问题，后续出现 27017 端口问题或 mongodb 类似的报错，多半是 mongo 服务没起或者挂了。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E7%BC%96%E8%AF%91%E9%9C%80%E8%A6%81java17%E7%8E%AF%E5%A2%83%E8%87%AA%E5%B8%A6gradle%E5%85%A8%E8%87%AA%E5%8A%A8%E7%BC%96%E8%AF%91%E8%84%9A%E6%9C%AC%E6%89%A7%E8%A1%8C%E5%B0%B1%E5%AE%8C%E4%BA%8B%E4%BA%86"><span class="toc-number">1.5.3.</span> <span class="toc-text">3. 编译，需要 java17 环境自带 gradle 全自动编译脚本，执行就完事了。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E4%B8%8B%E8%BD%BD%E8%B5%84%E6%BA%90%E6%96%87%E4%BB%B6"><span class="toc-number">1.5.4.</span> <span class="toc-text">4. 下载资源文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">1.5.5.</span> <span class="toc-text">5. 启动服务器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#qa"><span class="toc-number">1.5.6.</span> <span class="toc-text">QA</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E9%85%8D%E7%BD%AE%E6%8A%93%E5%8C%85%E4%BB%A5%E5%8F%8Ahttp%E6%B3%A8%E5%85%A5"><span class="toc-number">1.5.7.</span> <span class="toc-text">6. 配置抓包以及 http 注入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#windows%E7%AB%AF%E7%99%BB%E9%99%86"><span class="toc-number">1.6.</span> <span class="toc-text">windows 端登陆</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#qa-2"><span class="toc-number">1.7.</span> <span class="toc-text">QA</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ios%E7%AB%AF%E7%99%BB%E5%BD%95"><span class="toc-number">1.8.</span> <span class="toc-text">IOS 端登录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#android%E7%AB%AF%E7%99%BB%E5%BD%95"><span class="toc-number">1.9.</span> <span class="toc-text">Android 端登录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E8%AF%AD"><span class="toc-number">1.10.</span> <span class="toc-text">结语</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li class="active"><a href="/grasscutter/grasscutter/" rel="bookmark" title="grasscutter————原神私服搭建过程">grasscutter————原神私服搭建过程</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="Echidna" data-src="/images/avatar.jpg"><p class="name" itemprop="name">Echidna</p><div class="description" itemprop="description"></div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">24</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">12</span> <span class="name">分类</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL0VjaGlkbmEtc3ho" title="https:&#x2F;&#x2F;github.com&#x2F;Echidna-sxh"><i class="ic i-github"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>友達</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>友達</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"></div><div class="status"><div class="copyright">&copy; 2021 – <span itemprop="copyrightYear">2022</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">Echidna @ Echidna</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">163k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">2:28</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span> <img src="https://echidna-sxh.oss-cn-beijing.aliyuncs.com/o_1dfilp8ruo521thr1hvf18ji17soa.png"><a href="https://beian.miit.gov.cn/" style="color:#f72b07" target="_blank">苏ICP备20033098号-3</a></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"grasscutter/grasscutter/",favicon:{show:"欢迎回来~",hide:"Echidna的小窝"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/pace/1.2.4/pace.min.js"></script><script src="//lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/jquery/3.6.0/jquery.min.js"></script><script src="//lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/fancybox/3.5.7/jquery.fancybox.min.js"></script><script src="//lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js"></script><script src="https://unpkg.com/pjax@0.1.4/src/pjax.js"></script><script src="https://unpkg.com/whatwg-fetch@3.6.2/dist/fetch.umd.js"></script><script src="//lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/animejs/3.2.1/anime.min.js"></script><script src="//lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/algoliasearch/4.12.1/algoliasearch-lite.umd.min.js"></script><script src="//lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/instantsearch.js/4.39.0/instantsearch.production.min.js"></script><script src="//lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/lozad.js/1.16.0/lozad.min.js"></script><script src="//lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/quicklink/2.2.0/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html>